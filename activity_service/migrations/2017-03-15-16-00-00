"""
This script performs a massive migration for activities.
"""

from activity_service.app import db
from activity_service.common.models.user import User
from activity_service.common.models.misc import Activity

slice = 5000000/100000
for i in xrange(slice):
    activities = db.session.query(Activity).filter_by(domain_id = 0).yield_per(1000).limit(100000)
    for activity in activities:
        user = db.session.query(User).get(activity.user_id)
        activity.domain_id = user.domain_id
        db.session.add(activity)
        db.session.commit()
        if activity.id % 100 == 0:
            print activity.id
