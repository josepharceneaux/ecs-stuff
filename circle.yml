machine:
  python:
    version: 2.7.9
  environment:
    PYENV_VERSION: 2.7.9
    GT_ENVIRONMENT: circle
    PYTHONPATH: .

dependencies:
  override:
    - pip install -r requirements.txt
  post:
    - mkdir ~/.talent
    - "printf \"[cloudsearch]\nCLOUD_SEARCH_DOMAIN: gettalent-circleci\nCLOUD_SEARCH_REGION: us-west-1\n\n[s3]\nS3_BUCKET_NAME: tcs-local-circleci\nS3_FILEPICKER_BUCKET_NAME: gettalent-filepicker\nS3_BUCKET_REGION: us-west-1\n\n[local]\nEMAIL: farooqiumar@rocketmail.com\nGT_ENVIRONMENT: circle\nINSTANCE_NAME: circleci\n\n[iam]\nACCOUNT_ID: 528222547498\n\n[keys]\nAWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID\nAWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY\nSECRET_KEY: $SECRET_KEY\n\" > ~/.talent/web.cfg"

test:
  pre:
    - sudo chown -R ubuntu /var/log:
        parallel: true
    - python auth_service/run.py:
        parallel: true
        background: true
    - python user_service/run.py:
        parallel: true
        background: true
    - python resume_service/run.py:
        parallel: true
        background: true
    - python activity_service/run.py:
        parallel: true
        background: true
    - python candidate_service/run.py:
        parallel: true
        background: true
    - python social_network_service/run.py:
        parallel: true
        background: true
    - python candidate_pool_service/run.py:
        parallel: true
        background: true
    - python spreadsheet_import_service/run.py:
        parallel: true
        background: true
    - python scheduler_service/run.py:
        parallel: true
        background: true
    - sleep 5


  override:

    - ? >
          py.test
          auth_service/tests/
          user_service/tests/
          resume_service/tests/
          activity_service/tests/
          candidate_service/tests/
          candidate_pool_service/tests/
          spreadsheet_import_service/tests/
          scheduler_service/tests/
      : parallel: true

experimental:
  notify:
    branches:
      only:
        - master
        - develop
